<?php
	//SEO
	$seoTitle = Common::getSEOFormat('Notícias');
	$seoDescription = Common::getSEOFormat('');
	
	$pageActual = Common::fetchVar('page') ? Common::fetchVar('page') : 1;

	$listaBlog = LogicBlog::filter(['ipp' => 12, 'page' => $pageActual, 'is_ativo' => 1, 'is_publicavel' => 1]);
	$totalItens = LogicBlog::filter(['ipp' => 12,'total' => true]);

	$ipp = 12;
	$pageOffset = 6;
?>
<!DOCTYPE html>
<html lang="<?php PCWMLang::echoLang(); ?>">
	<?php
		PCWMPage::writeHead(array(
			"title" => $seoTitle,
			"description" => $seoDescription,
			"extra-js" => '',
			"extra-css" => '',
			"og:title" => '',
		));
	?>

	<body>
		<?php
			echo LogicMicrodata::breadcrumbBuild([
				['name' => 'Home', 'url' => WEBSITE_URL . '/'],
				['name' => 'Notícias', 'url' => WEBSITE_URL . '/blog']
			]);
			
			include(INCLUDES . 'header.php');
		?>

		<main class="wrapper">
			<section class="py-12 sm:py-16 lg:py-20">
				<div class="px-3">
					<div class="container mx-auto">
						<h1 class="titleStyle1"><span>Blog</span></h1>

						<div class="artigosGeraisLista flex flex-wrap mt-16">
						<?php 
							$listaBlog = LogicBlog::filter(['is_ativo' => 1, 'ipp' => 3]);
							if ($listaBlog) { 
								foreach ($listaBlog as $item) {
									$img = LogicBlogImagens::getImageUploadFolder(true) . LogicBlogImagens::getPrimaryImage($item->id)->filename;
									$dataPublicacaoAleatorios = Common::sql2date($item->data_publicacao, "-", $horas = false);
									$dateAletorios = new DateTime($dataPublicacaoAleatorios);

									if (!LogicBlogImagens::getPrimaryImage($item->id)->filename) {
										$img = PCWMImage::cacheImage('./img/im-no-photo.jpg', 388, false);
									}
									?>
									<a href="./blog/<?php echo $item->slug ?>" class="artigosBox flex flex-col mr-6 mb-6">
										<img class="" src="<?php echo PCWMImage::cacheImage($img, 388, false); ?>">
										<div class="artigoDescricao">
											<h3 class="titleStyle3"><?php echo $item->titulo_pt_br; ?></h3>
											<div class="paragrafosGerais mt-5">
												<p class="data text-base leading-7"><?php echo strftime('%e de %B de %Y', $dateAletorios->format("U")); ?></p>
											</div>
											<div class="artigoBarra"></div>
											<div class="paragrafosGerais mt-5">
												<?php 
												if (strlen($item->resumo_pt_br) > 150) {
													$resumo = substr($item->resumo_pt_br, 0, 150) . '...';
												}
												else {
													$resumo = $item->resumo_pt_br;
												} 
												?>
												<p class="text-base leading-7"><?php echo $resumo; ?></p>
											</div>
										</div>
									</a>
									<?php
								}
							}
							?>
						</div>
						<?php
						if (!$listaBlog) {
							?><div class="text-center mt-6 mb-8 lg:mt-10 lg:mb-12"><b>Não existe nenhuma notícia cadastrada nesta página!</b></div><?php
						}
						else {
							$paginationInfo = Common::getPaginacao($pageActual, $totalItens, $ipp, $pageOffset);

							if ($paginationInfo->totalPages > 1) {
								$pageBaseLink = 'noticia?page=';
								?><div class="boxPagination mt-12"><?php
								?><a href="<?php echo $pageBaseLink . 1; ?>" title="Primeira Página" aria-label="Primeira Página" class="page prevNextLast">&laquo;</a><?php
								if ($pageActual > 1) {
									?><a href="<?php echo $pageBaseLink . ($pageActual - 1); ?>" title="Página Anterior" aria-label="Página Anterior" class="page prevNextLast">&lsaquo;</a><?php
								}
								for ($i = $paginationInfo->fromPage; $i <= $paginationInfo->toPage; $i++) {
									?><a href="<?php echo $pageBaseLink . $i; ?>" class="page <?php echo $pageActual == $i ? 'actual' : ''; ?>" aria-label="Página <?php echo $i; ?>"><?php echo str_pad($i, 2, '0', STR_PAD_LEFT); ?></a><?php
								}
								if ($pageActual < $paginationInfo->totalPages) {
									?><a href="<?php echo $pageBaseLink . ($pageActual + 1); ?>" class="page prevNextLast" title="Próxima Página" aria-label="Próxima Página">&rsaquo;</a><?php
								}
								?><a href="<?php echo $pageBaseLink . $paginationInfo->totalPages; ?>" title="Última Página" aria-label="Última Página" class="page prevNextLast">&raquo;</a><?php
								?><p class="my-6">Listando item <b><?php echo (($pageActual - 1) * $ipp) + 1; ?> até <?php echo (($pageActual * $ipp) > $totalItens ? $totalItens : ($pageActual * $ipp)); ?></b> de <?php echo $totalItens; ?> itens.</p><?php
								?></div><?php
							}
						}
						?>
					</div>					
				</div>
			</section>
		</main>

    <?php Common::includeFile('footer.php'); ?>
	</body>
</html>